var _v="";Sheet.Validate=function(e){this.requiredValue="data-requiredfield",this.AttrName="data-vaildationrule",this.sheet=e,this.controls=[],this.init()},Sheet.Validate.prototype={init:function(){this.controls.length=0,this.sheet.container?this.sheet.container=$(this.sheet.container.context).find("input["+this.AttrName+"],textarea["+this.AttrName+"],select["+this.AttrName+"],div["+this.AttrName+"],span["+this.AttrName+"]"):this.sheet.container=$("input["+this.AttrName+"],textarea["+this.AttrName+"],select["+this.AttrName+"],div["+this.AttrName+"],span["+this.AttrName+"]"),this.sheet.container.each(function(e){if(!($(this).closest("tr").length>0&&$(this).closest("tr").hasClass("template"))){var t=$(this).attr(e.AttrName);t&&e.registerEvent(this.id,t)}},[this]),$.each(this.controls,function(e,t){$(t).change()})},registerEvent:function(e,t){for(var i,a=t.split("{"),s=1;s<a.length;s++){var h=a[s].indexOf("}");if(-1==h)return void alert(_Sheet_Validate_GlobalString.Sheet_Validate_Msg0+t);i=a[s].substring(0,h);var r=this.sheet.findControlByDataField($("#"+e),i);if(!r)return;r.unbind("change.Validate"+e).bind("change.Validate"+e,[this],function(i,a){0!=$("#"+e).length&&(_v=a,i.data[0].selectChanged($("#"+e),t))}),this.contains(i)||this.controls.push(r)}},contains:function(e){var t=!1;return $.each(this.controls,function(i,a){$(a).attr("data-datafield")==e&&(t=!0)}),t},selectChanged:function(e,t){for(var i,a=t.split("{"),s=a[0],h=1;h<a.length;h++){var r=a[h].indexOf("}");if(-1==r)return void alert(_Sheet_Validate_GlobalString.Sheet_Validate_Msg0+t);i=a[h].substring(0,r),_v?s="'"+_v+"'":s+="'"+this.sheet.getDataFieldValue(e,i)+"'",s+=a[h].substring(r+1)}var o=this.sheet.getResultValue(s),n=e.attr("data-type"),c="",l=new RegExp("(^|&)IsMobile=([^&]*)(&|$)"),d=top.window.location.search.substr(1).match(l);if(null!=d&&(c=unescape(d[2])),c){n=e.attr("data-type");if(o)if("SheetDropDownList"==n||"SheetCheckboxList"==n||"SheetRadioButtonList"==n||"SheetTextBox"==n||"SheetRichTextBox"==n){var u=null;switch(n){case"SheetDropDownList":u=$(e).SheetDropDownList();break;case"SheetCheckboxList":u=$(e).SheetCheckboxList();break;case"SheetRadioButtonList":u=$(e).SheetRadioButtonList();break;case"SheetTextBox":u=$(e).SheetTextBox(),e.attr("data-Required",!0);break;case"SheetRichTextBox":u=$(e).SheetRichTextBox()}u.Required=!0,u.Validate()}else e.parent().attr("data-Required",!0);else if("SheetDropDownList"==n||"SheetCheckboxList"==n||"SheetRadioButtonList"==n||"SheetTextBox"==n||"SheetRichTextBox"==n){u=null;switch(n){case"SheetDropDownList":u=$(e).SheetDropDownList();break;case"SheetCheckboxList":u=$(e).SheetCheckboxList();break;case"SheetRadioButtonList":u=$(e).SheetRadioButtonList();break;case"SheetTextBox":u=$(e).SheetTextBox(),e.removeAttr("data-Required");break;case"SheetRichTextBox":u=$(e).SheetRichTextBox()}u.Required=!1,u.RemoveInvalidText(u.Element)}else{e.parent().removeAttr("data-Required"),e.parent().removeClass($.MvcSheetUI.Css.inputError);var S=e.parent().next();S.hasClass("InvalidText")&&S.remove()}}else if(o)if("SheetDropDownList"==n||"SheetCheckboxList"==n||"SheetRadioButtonList"==n){u=null;switch(n){case"SheetDropDownList":u=$(e).SheetDropDownList();break;case"SheetCheckboxList":u=$(e).SheetCheckboxList();break;case"SheetRadioButtonList":u=$(e).SheetRadioButtonList()}u.Required=!0,u.Validate()}else{e.attr("data-Required",!0);u=$(e).SheetUIManager();u&&(u.Required=!0)}else if("SheetDropDownList"==n||"SheetCheckboxList"==n||"SheetRadioButtonList"==n){u=null;switch(n){case"SheetDropDownList":u=$(e).SheetDropDownList();break;case"SheetCheckboxList":u=$(e).SheetCheckboxList();break;case"SheetRadioButtonList":u=$(e).SheetRadioButtonList()}u.Required=!1,u.RemoveInvalidText(u.Element)}else{e.removeAttr("data-Required"),e.removeClass($.MvcSheetUI.Css.inputError);S=e.next();S.hasClass("InvalidText")&&S.remove();u=$(e).SheetUIManager();u&&(u.Required=!1)}e.trigger("change")}};