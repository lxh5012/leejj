var _v="",_Sheet_Display_GlobalString={Sheet_Display_Msg0:"显示规则设置错误："};Sheet.Display=function(t){this.AttrName="data-displayrule",this.sheet=t,this.controls=[],this.init()},Sheet.Display.prototype={init:function(){this.controls.length=0,this.sheet.container?this.sheet.container=$(this.sheet.container.context).find("input["+this.AttrName+"],span["+this.AttrName+"],textarea["+this.AttrName+"],select["+this.AttrName+"],div["+this.AttrName+"],label["+this.AttrName+"]"):this.sheet.container=$("input["+this.AttrName+"],span["+this.AttrName+"],textarea["+this.AttrName+"],select["+this.AttrName+"],div["+this.AttrName+"],label["+this.AttrName+"]"),this.sheet.container.each(function(t){if(!$(this).parent().parent().hasClass("template")){var e=$(this).attr(t.AttrName);e&&t.registerEvent(this.id,e)}},[this]),$.each(this.controls,function(t,e){$(e).change()})},registerEvent:function(t,e){for(var i,a=e.split("{"),n=1;n<a.length;n++){var s=a[n].indexOf("}");if(-1==s)return void alert(_Sheet_Display_GlobalString.Sheet_Display_Msg0+e);i=a[n].substring(0,s);var r=this.sheet.findControlByDataField($("#"+t),i);if(!r)return;r.unbind("change."+t).bind("change."+t,[this],function(i,a){0!=$("#"+t).length&&(_v=a,i.data[0].selectChanged($("#"+t),e))}),this.controls.push(r)}},contains:function(t){var e=!1;return $.each(this.controls,function(i,a){$(a).attr("data-datafield")==t&&(e=!0)}),e},setDisplay:function(t,e){e?(t.removeClass("hidden"),t.next().length>0&&t.next().attr("for")&&t.next().attr("for")==t.attr("id")&&t.next().removeClass("hidden")):(t.addClass("hidden"),t.next().length>0&&t.next().attr("for")&&t.next().attr("for")==t.attr("id")&&t.next().addClass("hidden"))},selectChanged:function(t,e){for(var i,a=e.split("{"),n=a[0],s=1;s<a.length;s++){var r=a[s].indexOf("}");if(-1==r)return void alert(_Sheet_Display_GlobalString.Sheet_Display_Msg0+e);i=a[s].substring(0,r),_v?n="'"+_v+"'":n+="'"+this.sheet.getDataFieldValue(t,i)+"'",n+=a[s].substring(r+1)}var h=this.sheet.getResultValue(n),l="",o=new RegExp("(^|&)IsMobile=([^&]*)(&|$)"),p=top.window.location.search.substr(1).match(o);if(null!=p&&(l=unescape(p[2])),l)if(h){var d=t.parent().parent();d.is("tr")&&this.setDisplay(d,!0);var c=!1;"SheetDropDownList"==t.attr("data-type")&&("View"==$.MvcSheetUI.QueryString("Mode")?c=!0:"Work"==$.MvcSheetUI.QueryString("Mode")?t.next().is("label")&&(c=!0):this.setDisplay(t.parent().find(".select2-container"),!0)),"SheetTextBox"==t.attr("data-type")&&("View"==$.MvcSheetUI.QueryString("Mode")?c=!0:"Work"==$.MvcSheetUI.QueryString("Mode")&&t.next().is("label")&&(c=!0)),"SheetRichTextBox"==t.attr("data-type")&&("View"==$.MvcSheetUI.QueryString("Mode")?c=!0:"Work"==$.MvcSheetUI.QueryString("Mode")&&t.parent().find("div.SheetRichTextBox").length>0&&(c=!0)),c||this.setDisplay(t.parent(),!0)}else{"SheetDropDownList"==t.attr("data-type")&&this.setDisplay(t.parent().find(".select2-container"),!1),this.setDisplay(t.parent(),!1);d=t.parent().parent();var y=!1;d.find("label,span,input,select,textarea").each(function(){"none"!=this.style.display&&(y=!0)}),y||("SheetDropDownList"==t.attr("data-type")&&this.setDisplay(t.parent().find(".select2-container"),!1),this.setDisplay(d.parent(),!1))}else if(h){d=t.parent().parent();d.is("tr")&&this.setDisplay(d,!0);c=!1;"SheetDropDownList"==t.attr("data-type")&&("View"==$.MvcSheetUI.QueryString("Mode")?c=!0:"Work"==$.MvcSheetUI.QueryString("Mode")?t.next().is("label")&&(c=!0):this.setDisplay(t.parent().find(".select2-container"),!0)),"SheetTextBox"==t.attr("data-type")&&("View"==$.MvcSheetUI.QueryString("Mode")?c=!0:"Work"==$.MvcSheetUI.QueryString("Mode")&&t.next().is("label")&&(c=!0)),"SheetRichTextBox"==t.attr("data-type")&&("View"==$.MvcSheetUI.QueryString("Mode")?c=!0:"Work"==$.MvcSheetUI.QueryString("Mode")&&t.parent().find("div.SheetRichTextBox").length>0&&(c=!0)),c||this.setDisplay(t,!0)}else{"SheetDropDownList"==t.attr("data-type")&&this.setDisplay(t.parent().find(".select2-container"),!1),this.setDisplay(t,!1);d=t.parent().parent(),y=!1;d.find("label,span,input,select,textarea").each(function(){"none"!=this.style.display&&(y=!0)}),y||("SheetDropDownList"==t.attr("data-type")&&this.setDisplay(t.parent().find(".select2-container"),!1),this.setDisplay(d,!1))}}};