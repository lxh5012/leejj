var MvcSheetUIGlobalString={RegularExpression_errorMessage:"绑定的正则表达式不合法:"};(function($){Function.prototype.Inherit=function(e,t){if("function"!=typeof e)return this;this.Base=e.prototype,this.Base.constructor=e;var i=function(){};i.prototype=e.prototype,this.prototype=new i,this.prototype.constructor=this,t&&$.extend(this.prototype,t)},String.prototype={trim:function(){return this.replace(/[ ]/g,"")}},Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},$.fn.SheetUIManager=function(e){var t;if($(this).data($.MvcSheetUI.SheetIDKey))return $.MvcSheetUI.ControlManagers[$(this).data($.MvcSheetUI.SheetIDKey)];var i=$(this).data($.MvcSheetUI.DataFieldKey.toLowerCase());if(null==i)return t;var a=$.MvcSheetUI.GetSheetDataItem(i,e);return null==a?t:($(this).each(function(){if(null==t)switch(this.tagName.toLowerCase()){case"label":case"span":t=$(this).SheetLabel(a);break;case"input":switch(this.type){case"text":t=a.L==$.MvcSheetUI.LogicType.DateTime?$(this).SheetTime(a):a.L==$.MvcSheetUI.LogicType.SheetAssociation?$(this).SheetAssociation(a):$(this).SheetTextBox(a);break;case"checkbox":$(this).SheetCheckbox(a);break;case"radio":t=$(this).SheetRadioButtonList(a)}break;case"textarea":t=$(this).SheetRichTextBox(a);break;case"div":var e=$(this).data("type");e?("sheetoffice"!=e.toLowerCase()||window.ActiveXObject||"ActiveXObject"in window||(e="SheetAttachment"),t=$.MvcSheetUI.Run.call($(this),e,[a])):a&&(a.L==$.MvcSheetUI.LogicType.SingleParticipant||a.L==$.MvcSheetUI.LogicType.MultiParticipant?t=$(this).SheetUser(a):a.L==$.MvcSheetUI.LogicType.Attachment?t=$(this).SheetAttachment(a):a.L==$.MvcSheetUI.LogicType.Comment?t=$(this).SheetComment(a):a.L==$.MvcSheetUI.LogicType.TimeSpan&&(t=$(this).SheetTimeSpan(a)));break;case"table":a.L!=$.MvcSheetUI.LogicType.BizObjectArray&&a.L!=$.MvcSheetUI.LogicType.BizObject||(t=$(this).SheetGridView(a));break;case"select":t="SheetInstancePrioritySelector"==$(this).data("type")?$(this).SheetInstancePrioritySelector(a):"SheetOriginatorUnit"==$(this).data("type")?$(this).SheetOriginatorUnit(a):$(this).SheetDropDownList(a);break;case"a":t=$(this).SheetHyperLink(a)}}),t)},$.fn.SheetUIManager2=function(e){var t;if($(this).data($.MvcSheetUI.SheetIDKey))return $.MvcSheetUI.ControlManagers[$(this).data($.MvcSheetUI.SheetIDKey)];var i=$(this).data($.MvcSheetUI.DataFieldKey.toLowerCase());if(null==i)return t;var a=$.MvcSheetUI.GetSheetDataItem2(i,e);return null==a?t:($(this).each(function(){if(null==t)switch(this.tagName.toLowerCase()){case"label":case"span":t=$(this).SheetLabel(a);break;case"input":switch(this.type){case"text":t=a.L==$.MvcSheetUI.LogicType.DateTime?$(this).SheetTime(a):a.L==$.MvcSheetUI.LogicType.SheetAssociation?$(this).SheetAssociation(a):$(this).SheetTextBox(a);break;case"checkbox":$(this).SheetCheckbox(a);break;case"radio":t=$(this).SheetRadioButtonList(a)}break;case"textarea":t=$(this).SheetRichTextBox(a);break;case"div":var e=$(this).data("type");e?("sheetoffice"!=e.toLowerCase()||window.ActiveXObject||"ActiveXObject"in window||(e="SheetAttachment"),t=$.MvcSheetUI.Run.call($(this),e,[a])):a&&(a.L==$.MvcSheetUI.LogicType.SingleParticipant||a.L==$.MvcSheetUI.LogicType.MultiParticipant?t=$(this).SheetUser(a):a.L==$.MvcSheetUI.LogicType.Attachment?t=$(this).SheetAttachment(a):a.L==$.MvcSheetUI.LogicType.Comment?t=$(this).SheetComment(a):a.L==$.MvcSheetUI.LogicType.TimeSpan&&(t=$(this).SheetTimeSpan(a)));break;case"table":a.L!=$.MvcSheetUI.LogicType.BizObjectArray&&a.L!=$.MvcSheetUI.LogicType.BizObject||(t=$(this).SheetGridView(a));break;case"select":t="SheetInstancePrioritySelector"==$(this).data("type")?$(this).SheetInstancePrioritySelector(a):"SheetOriginatorUnit"==$(this).data("type")?$(this).SheetOriginatorUnit(a):$(this).SheetDropDownList(a);break;case"a":t=$(this).SheetHyperLink(a)}}),t)},$.MvcSheetUI={Version:"V1.0",SheetIDKey:"sheetid",PreDataKey:"data-",DataFieldKey:"DataField",ComputationRule:"ComputationRule",SheetControlKey:"SheetControl",Type:"Type",PortalRoot:""==window.localStorage.getItem("H3.PortalRoot")?getRootPath_web():window.localStorage.getItem("H3.PortalRoot"),SheetInfo:null,MvcRuntime:null,Priority:"Unspecified",ParentUnitID:"",HiddenFields:{},Loading:!1,Controls:{},ManagerCount:0,ControlManagers:{},IonicFramework:{},Css:{inputMouseOut:"inputMouseOut",inputMouseMove:"inputMouseMove",inputMouseEnter:"inputMouseEnter",inputError:"inputError",InvalidText:"InvalidText",Readonly:"Readonly"},ValidateText:"表单验证不通过!",Run:function(e,t){var i=$.ControlsOptions.GetDefaultOptions(e);t.length>0&&($.extend(i,{DataItem:t[0]}),$.extend(i,t[0]));var a=0,n=0;if(this.each(function(){$(this).data($.MvcSheetUI.SheetIDKey)?n=1:(n++,$.MvcSheetUI.ManagerCount++,a=$.MvcSheetUI.SheetIDKey+"-"+$.MvcSheetUI.ManagerCount.toString(),i[$.MvcSheetUI.DataFieldKey]=$(this).data($.MvcSheetUI.DataFieldKey.toLowerCase()),i[$.MvcSheetUI.Type]=e,$(this).data($.MvcSheetUI.SheetIDKey,a),$.MvcSheetUI.ControlManagers[$(this).data($.MvcSheetUI.SheetIDKey)]=new $.MvcSheetUI.Controls[e](this,i,$.MvcSheetUI.SheetInfo))}),1==n)return $.MvcSheetUI.ControlManagers[$(this).data($.MvcSheetUI.SheetIDKey)]},GetSheetDataItem:function(e,t){var i=$.MvcSheetUI.SheetInfo.BizObject.DataItems;if(null==e)return null;var a=null;if(e.indexOf(".")>-1&&i[e.split(".")[0]]&&i[e.split(".")[0]].L==$.MvcSheetUI.LogicType.BizObject){if(i[e.split(".")[0]].V.DataItems)return a=i[e.split(".")[0]].V.DataItems[e],$.extend(a,{BizObjectID:i[e.split(".")[0]].V.DataItems[e.split(".")[0]+".ObjectID"].V}),$.extend(a,{RowNum:1}),i[e.split(".")[0]].V.DataItems[e]}else if(null!=t&&t>0&&e.indexOf(".")>-1){t-=1;var n=e.split(".")[0],s=i[n].V;if(s.R&&s.R.length>t)a=s.R[t].DataItems[e],$.extend(a,{BizObjectID:s.R[t].DataItems[n+".ObjectID"].V});else{var o=s.T;o||(o=this.GetElement(n).SheetUIManager().DefaultRow),o&&(a=o.DataItems[e])}$.extend(a,{RowNum:t+1})}else a=i[e],$.extend(a,{RowNum:0});return"OriginateTime"==e&&(a.V=new Date(a.V.replace(/-/g,"/")).format("yyyy-MM-dd hh:mm")),a},GetSheetDataItem2:function(e,t){var i=$.MvcSheetUI.SheetInfo.BizObject.DataItems;if(null==e)return null;var a=null;if(e.indexOf(".")>-1&&i[e.split(".")[0]]&&i[e.split(".")[0]].L==$.MvcSheetUI.LogicType.BizObject){if(i[e.split(".")[0]].V.DataItems)return a=i[e.split(".")[0]].V.DataItems[e],$.extend(a,{BizObjectID:i[e.split(".")[0]].V.DataItems[e.split(".")[0]+".ObjectID"].V}),$.extend(a,{RowNum:1}),i[e.split(".")[0]].V.DataItems[e]}else if(null!=t&&t>0&&e.indexOf(".")>-1){t-=1;var n=e.split(".")[0],s=i[n].V;if(s.R&&s.R.length>t)a=s.R[t].DataItems[e],a.V="",$.extend(a,{BizObjectID:s.R[t].DataItems[n+".ObjectID"].V});else{var o=s.T;o||(o=this.GetElement(n).SheetUIManager().DefaultRow),o&&(a=o.DataItems[e])}$.extend(a,{RowNum:t+1})}else a=i[e],$.extend(a,{RowNum:0});return"OriginateTime"==e&&(a.V=new Date(a.V.replace(/-/g,"/")).format("yyyy-MM-dd hh:mm")),a},SaveSheetData:function(e){var t={};for(var i in this.ControlManagers){var a=this.ControlManagers[i];if(a.Type&&"SheetHiddenField"==a.Type)$.extend(t,a.SaveDataField(e));else{if(!$.isFunction(a.SaveDataField)||null==a.DataField||-1!=a.DataField.indexOf(".")&&"Originator.OUName"!=a.DataField)continue;$.extend(t,a.SaveDataField(e))}}return t},GetElement:function(e,t){var i,a=null==t?0:t;return 0==e.indexOf("#")?i=$(e):e.indexOf(".")>-1?(null==t&&(a=1),i=$("tr[data-row='"+a+"']").find("["+this.PreDataKey+this.DataFieldKey.toLowerCase()+"='"+e+"']"),"true"!=$.MvcSheetUI.QueryString("ismobile")&&0!=i.length||(i=$("div[data-row='"+a+"']").find("["+this.PreDataKey+this.DataFieldKey.toLowerCase()+"='"+e+"']"))):$("["+this.PreDataKey+this.DataFieldKey.toLowerCase()+"='"+e+"']").each(function(){var t=!0;"td"==this.tagName.toLowerCase()?t=!1:"div"==this.tagName.toLowerCase()&&$("table["+$.MvcSheetUI.PreDataKey+$.MvcSheetUI.DataFieldKey.toLowerCase()+"='"+e+"']").length>0&&(t=!1),t&&(i=("label"!=this.tagName.toLowerCase()&&"span"!=this.tagName.toLowerCase()||$(this).attr("BindType"),$(this)))}),i},GetControlValue:function(e,t){var i=this.GetElement(e,t);if(i){var a=$(i).SheetUIManager();return a?a.GetValue():null}return null},SetControlValue:function(e,t,i){var a=this.GetElement(e,i);if(a){var n=$(a).SheetUIManager();n&&n.SetValue(t)}},Validate:function(e,t){var i=!0;for(var a in t||(t=!1),e.IsReject&&(t=!0),this.ControlManagers){var n=this.ControlManagers[a];$.isFunction(n.Validate)&&(n instanceof $.MvcSheetUI.Controls.SheetComment&&e.IsReject?!n.Validate(!1)&&i&&(n.SetFocus(),i=!1):!n.Validate(t)&&i&&(n.SetFocus(),i=!1))}return i||alert(SheetLanguages.Current.SheetValidateError),i}},$.ControlsOptions={GetDefaultOptions:function(e){var t={},i=SheetControls[e]||this[e];for(var a in i)if(i[a].constructor==String||i[a].constructor==Number||i[a].constructor==Object)t[a]=i[a]||"";else if(i[a].constructor==Array)for(var n=0;n<i[a].length;++n)t[i[a][n].Name]=i[a][n].DefaultValue||"";return t}},$.MvcSheetUI.SheetMode={Unspecified:-1,Work:1,View:2,Originate:3,Print:4},$.MvcSheetUI.LogicType={Unspecified:-1,BoolArray:0,Bool:1,DateTimeArray:4,DateTime:5,DoubleArray:6,Double:7,IntArray:8,Int:9,LongArray:10,Long:11,StringArray:12,String:13,ShortString:14,HyperLink:16,Comment:17,ByteArray:20,Attachment:24,TimeSpan:25,SingleParticipant:26,MultiParticipant:27,Html:30,Object:31,Xml:32,Guid:33,GuidArray:34,Decimal:35,DecimalArray:36,BizObject:40,BizObjectArray:41,BizStructure:42,BizStructureArray:43,SheetAssociation:45},$.MvcSheetUI.UnitType={Unspecified:127,Company:1,OrganizationUnit:2,Group:4,User:8,Segment:16,Post:32,Staff:64},$.MvcSheetUI.QueryString=function(e){var t=new RegExp("(^|&)"+e.toLowerCase()+"=([^&]*)(&|$)","i"),i=decodeURI(window.location.search.toLowerCase().substr(1)).match(t);return null!=i?decodeURI(i[2]):null},$.MvcSheetUI.NewGuid=function(){var e=function(e){return e>12&&(e=12),Math.floor(1e14*Math.random()).toString("16").substring(0,e)};return(e(8)+"-"+e(4)+"-4"+e(3)+"-"+e(4)+"-"+e(12)).trim()},$.SheetModal=function(e,t,i){this.IsShow=!1,this.ShowModal(e,t,i)},$.SheetModal.prototype={ShowModal:function(e,t,i){this.ID=$.MvcSheetUI.NewGuid(),this.Modal=$('<div class="modal fade" id="'+this.ID+'" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"></div>');var a=$('<div class="modal-dialog"></div>'),n=$('<div class="modal-content"></div>'),s=$('<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>');if(this.ModalTitle=$('<h4 class="modal-title" id="myModalLabel"></h4>'),this.ModalBody=$('<div class="modal-body"></div>'),this.ModalFooter=$('<div class="modal-footer"></div>'),this.Modal.append(a),a.append(n),n.append(s),s.append(this.ModalTitle),n.append(this.ModalBody),n.append(this.ModalFooter),this.SetTile(e),this.SetBody(t),i)for(var o=0;o<i.length;o++){var r=i[o];this.AddAction(r)}return this.Show(),this.Modal.on("hidden.bs.modal",this,function(e){e.data.IsShow=!1}),this},SetTile:function(e){this.ModalTitle.html(e)},SetBody:function(e){this.ModalBody.append($(e))},AddAction:function(e){$.extend(e,{ModalManager:this});var t="";t="确定"==e.Text?$('<button type="button" class="btn btn-primary"> '+e.Text+"</button>"):$('<button type="button" class="btn btn-default"> '+e.Text+"</button>"),e.DoAction&&t.unbind("click").bind("click",e,function(e){e.data.DoAction.apply(e.data)}),this.ModalFooter.append(t)},Show:function(){this.IsShow||(this.IsShow=!0,this.Modal.modal("show"))},Hide:function(){this.IsShow&&(this.IsShow=!1,this.Modal.modal("hide"))}},$.extend({LoadingMask:{Show:function(e,t){if($.MvcSheetUI.QueryString("ismobile")&&"true"==$.MvcSheetUI.QueryString("ismobile").toLowerCase())$.MvcSheetUI.IonicFramework.fcommonJS.loadingShow("");else{if($.SheetMask.IsShow)return;$.SheetMask.Show(t),this.MsgDiv=$("<div class='loading-data-box'></div>"),this.MsgDiv.append($("<p class='loading-box-icon' style='text-align: center;padding-bottom: 5px'><i class=\"icon-loading\"></i></p>")),this.MsgDiv.append($('<p style="font-size: 16px;color: rgba(0,0,0,0.45)">'+e+"</p>")),this.MsgDiv.css("position","fixed"),this.MsgDiv.css("top","42%"),this.MsgDiv.css("left","43%"),this.MsgDiv.css("z-index","9999"),this.MsgDiv.css("padding","20px"),this.MsgDiv.appendTo($("body"))}},Hide:function(){$.MvcSheetUI.QueryString("ismobile")&&"true"==$.MvcSheetUI.QueryString("ismobile").toLowerCase()?$.MvcSheetUI.IonicFramework.fcommonJS.loadingHide():$.SheetMask.IsShow&&($.SheetMask.Hide(),this.MsgDiv.remove())}},SheetMask:{IsShow:!1,Show:function(e){var t=.6;null!=e&&0==e&&(t=1),this.IsShow||(this.IsShow=!0,this.ID=$.MvcSheetUI.NewGuid(),this.Mask=$("<div></div>").attr("id","SheetMask_"+this.ID),this.Mask.appendTo($("body")),this.Mask.css("position","absolute"),this.Mask.css("top","0px"),this.Mask.css("left","0px"),this.Mask.css("width","100%"),this.Mask.css("height",$("body").height()+60),this.Mask.css("text-align","center"),this.Mask.css("z-index","9999"),this.Mask.css("background-color","#f4f6fc"),this.Mask.css("filter","Alpha (opacity=1)"),this.Mask.css("opacity",t),$("body").css("overflow","hidden"))},Hide:function(){this.IsShow&&(this.IsShow=!1,this.Mask.remove(),$("body").css("overflow",""))}}}),$.MvcSheetUI.IControl=function(e,t,i){this.IsHtml5=!!window.ActiveXObject||"ActiveXObject"in window||"undefined"!=typeof Worker,this.SchemaCode=i?i.SchemaCode:"",this.PortalRoot=$.MvcSheetUI.PortalRoot,this.Element=e,(i&&i.IsMobile||"true"==$.MvcSheetUI.QueryString("ismobile"))&&(this.IsMobile=!0);var a=$.MvcSheetUI.QueryString("Mode");this.Originate=a&&"originate"==a.toLowerCase(),this.Originate=t.Originate||this.Originate,this.Css={inputMouseOut:$.MvcSheetUI.Css.inputMouseOut,inputMouseMove:$.MvcSheetUI.Css.inputMouseMove,inputMouseEnter:$.MvcSheetUI.Css.inputMouseEnter,inputError:$.MvcSheetUI.Css.inputError,InvalidText:$.MvcSheetUI.Css.InvalidText},this.ValidateResult=!0,this.Options=t||{},this.SheetInfo=i,this.ViewInNewContainer=!0,this.Init();var n=$(e).data("filterColumnType");switch(n){case 3:this.LogicType=$.MvcSheetUI.LogicType.SingleParticipant;break;case 4:this.LogicType=$.MvcSheetUI.LogicType.MultiParticipant;break;default:this.LogicType=this.L||$.MvcSheetUI.LogicType.ShortString}if(this.Visiable=this.IsMobile?this.O&&-1!=this.O.indexOf("M"):this.O&&-1!=this.O.indexOf("V"),this.Visiable=this.Options.Visiable||this.Visiable,this.Editable=this.O&&-1!=this.O.indexOf("E"),this.Editable=this.Options.Editable||this.Editable,a&&"print"==a.toLowerCase()&&(this.Editable=!1),this.MobileContainer=null,this.FormatAction="GetFormatValue",this.Required=this.O&&-1!=this.O.indexOf("R"),this.TrackVisiable=this.O&&-1!=this.O.indexOf("T"),$(this.Element).parent().attr("data-title",($(this.Element).parent().prev().text()||"").trim()),this.PreRender(),this.IsMobile){this.Mask=$("<span class='input-label'></span>"),this.Visiable||($(this.Element).parent().hide(),$(this.Element).parent().prev().hide());var s=" item-input",o=$(this.Element).data("type");if("SheetTextBox"==o?$(this.Element).attr("autocomplete","off"):"SheetDropDownList"==o?(s="item-input",this.Editable||(s=" item-input ")):"SheetCheckbox"==o&&(s="item-input item-toggle"),0!=$(this.Element).parent().length&&$(this.Element).parent().attr("class")&&($(this.Element).parent().attr("class").indexOf("col-md-4")>-1||$(this.Element).parent().attr("class").indexOf("col-md-10")>-1)){var r=$(this.Element).parent().attr("class"),h="";if(r.indexOf("col-md-4")>-1)for(var l=0;l<r.split("col-md-4").length;l++){var c=r.split("col-md-4")[l];""!=c&&"col-md-10"!=c.trim()&&(h=h+" "+c)}else if(r.indexOf("col-md-10")>-1)for(l=0;l<r.split("col-md-10").length;l++){c=r.split("col-md-10")[l];""!=c&&"col-md-4"!=c.trim()&&(h=h+" "+c)}var d=$("<div class='detail "+h+"'></div>");"SheetCheckbox"==o&&(d=$("<label class='toggle toggle-positive'></label>"));var u=$(this.Element).parent();d.append(u.children()),"SheetCheckbox"==o&&d.append('<div class="track"><div class="handle"></div></div>'),u.empty().append(d),u.attr("class","").addClass("item "+s);var p=$("<span class='input-label'>"+u.data("title")+"</span>");u.prev().attr("class").indexOf("col-md-2")>-1&&(u.prev().find("span").length>0&&(p=u.prev().find("span").addClass("input-label")),u.prev().remove()),d.before(p)}this.RenderMobile&&this.RenderMobile()}else this.Render();this.Rendered(),this.IsMobile?$(this.Element).is("label,span")&&"all"!=($(this.Element).attr("bindtype")||"").toLowerCase()||!this.Editable||(this.Validate(!0,!0)?$(this.Element).trigger("MobileValidateSucceed"):$(this.Element).trigger("MobileValidateFaild")):this.Editable&&this.Validate(!0,!0)},$.MvcSheetUI.IControl.prototype={Init:function(){var e=this,t=this.Options;for(var i in t){var a=i.toLowerCase();null!=$(e.Element).data(a)&&(t[i].constructor==Boolean?t[i]=$(e.Element).data(a).constructor==Boolean?$(e.Element).data(a):"true"==$(e.Element).data(a).toString().toLowerCase()||"1"==$(e.Element).data(a).toString().toLowerCase():t[i].constructor==Number?t[i]=parseInt($(e.Element).data(a)):t[i]=$(e.Element).data(a).toString())}t=this.Options;for(var i in t)this[i]=t[i];$.MvcSheet&&$.MvcSheet.ControlInit.apply(this,[this.DataItem,this.SheetInfo])},AddInvalidText:function(e,t,i){e.id;if((null==i||i)&&$(e).addClass(this.Css.inputError),0==$.MvcSheetUI.SheetInfo.IsMobile)$(e).next().hasClass(this.Css.InvalidText)||$('<label class="'+this.Css.InvalidText+'">'+t+"</label>").insertAfter($(e));else{if(e.dataset&&"SheetComment"==e.dataset.type){if(0==$(e).prev().find("."+this.Css.InvalidText).length){var a=$('<label class="'+this.Css.InvalidText+'">'+t+"</label>");a.appendTo($(e).prev())}return}if(0==$(e).closest(".item.item-input").find(".input-label").find("."+this.Css.InvalidText).length){var n=$(e).closest(".item.item-input").find(".input-label")[0],s=$(n).text();$(n).empty(),$("<span>"+s+"</span>").appendTo($(n));a=$('<label class="'+this.Css.InvalidText+'">'+t+"</label>");"*"!==t&&a.addClass("plentyWords"),a.appendTo($(e).closest(".item.item-input").find(".input-label")[0])}}},RemoveInvalidText:function(e){if($(e).removeClass(this.Css.inputError),0==$.MvcSheetUI.SheetInfo.IsMobile)$(e).next().hasClass(this.Css.InvalidText)&&$(e).next().remove();else{if(e.dataset&&"SheetComment"==e.dataset.type)return void $(e).prev().find("."+this.Css.InvalidText).remove();$(e).closest(".item.item-input").find("."+this.Css.InvalidText).remove()}},PreRender:function(){$.MvcSheet&&$.MvcSheet.ControlPreRender.apply(this,[this.DataItem,this.SheetInfo])},Render:function(){},RunScript:function(e,t,i){t&&($.isFunction(t)?t.apply(e,i):new Function(t).apply(e,i))},GetRowNumber:function(){return this.RowNum<=0?this.RowNum:this.IsMobile?$(this.Element).attr("data-row"):$(this.Element).closest("tr[class='rows']").attr("data-row")},RenderMobile:function(){this.Render(),!this.Editable||!this.Visiable||$(this.Element).is("label,span")&&"all"!=($(this.Element).attr("bindtype")||"").toLowerCase()||(this.ViewInNewContainer?this.MoveToMobileContainer(this.Element):$(this.Element).is("select")&&$(this.Element).attr("dir","rtl"))},MoveToMobileContainer:function(e){_Element=e||this.Element;var t=this.Mask.text(this.GetText());t.insertAfter(_Element),this instanceof $.MvcSheetUI.Controls.SheetTimeSpan&&$(_Element).hide(),$(_Element).is("textarea")&&$(_Element).css("min-height","120px");var i=this;$(_Element).unbind("change.MobileEditable").bind("change.MobileEditable",function(e){t.text(i.GetText())}),$(_Element).unbind("MobileValidateFaild").bind("MobileValidateFaild",function(e){$(t).addClass("error")}),$(_Element).unbind("MobileValidateSucceed").bind("MobileValidateSucceed",function(e){$(t).removeClass("error")}),this instanceof $.MvcSheetUI.Controls.SheetAttachment&&!this.Editable&&this.V&&0==this.V.length&&(viewable=!1,$(t).removeClass("input-mask"))},Rendered:function(){$.MvcSheet&&$.MvcSheet.ControlRendered.apply(this,[this.DataItem,this.SheetInfo])},SaveDataField:function(){return{}},MobilePreBack:function(){return!0},AfterMobileEditShow:function(){},GetValue:function(){var e=null;return e=$(this.Element).is("label,span")?$(this.Element).html():$(this.Element).val(),this.FormatRule&&(e=e.replace(/,/g,"").replace(/$/g,"").replace(/¥/g,"")),e},SetValue:function(e){$(this.Element).val(e),this.IsMobile&&this.Mask.html(this.GetText())},GetText:function(){return $(this.Element).val()},SetReadonly:function(e){},SetVisiable:function(e){e?$(this.Element).show():$(this.Element).hide()},Validate:function(e,t){if(!this.Editable)return!0;if(t)return!(this.Required&&!this.GetValue())||(this.AddInvalidText(this.Element,"*",!1),!1);if(!e&&this.Required){if(!this.GetValue())return this.AddInvalidText(this.Element,"*"),!1;this.RemoveInvalidText(this.Element)}return!0},DoValidate:function(e,t,i){return!e||(e.apply(this,t)?(this.RemoveInvalidText(this.Element),!0):(this.AddInvalidText(this.Element,i),!1))},Valid:{RegularExpression:function(val,expression){try{return eval(expression).test(val)}catch(e){return alert(MvcSheetUIGlobalString.RegularExpression_errorMessage+expression),!0}},Required:function(e){return!!e&&e.trim()},Integer:function(e){return/^(-|\+)?(\d)*$/.test(e)},VerifyIntRange:function(e){return!(e<Math.pow(-2,31)||e>Math.pow(2,31)-1)},VerifyLongRange:function(e){return!(e<Math.pow(-2,53)||e>Math.pow(2,53)||"9007199254740993"==e)},Number:function(e){return/^[\+\-]?\d*?\.?\d*?$/.test(e)},TimeSpan:function(e){return/^((20|21|22|23|[0-1]\d)\:[0-5][0-9])(\:[0-5][0-9])?$/.test(e)}},SetFocus:function(){$(this.Element).focus()},RenderDataTrackLink:function(){if(!this.SheetInfo||!this.SheetInfo.IsMobile){var e=(this.Element.id||"")+"_PopWindow",t='<a class="nav-icon fa fa-list-alt" style="padding-left:5px;line-height: 2.4;" data-toggle="modal" data-target=\'#'+e+"'></a>";$(t).insertAfter($(this.Element));var i=$.MvcSheetUI.PortalRoot+"/InstanceDataTrack.html?";i+="InstanceId="+$.MvcSheetUI.SheetInfo.InstanceId+"&WorkItemId="+$.MvcSheetUI.SheetInfo.WorkItemId+"&ItemName="+this.DataField+"&F=frm_"+e,this.CreatePopupDiv(e,$.Lang("TrackTable.Track"),i,"400px")}},RefreshDataTrackLink:function(){var e=(this.Element.id||"")+"_PopWindow",t=document.getElementById("frm_"+e);t&&t.src&&(t.src=t.src)},CreatePopupDiv:function(e,t,i,a){var n="<div id='"+e+"' class='modal fade' tabindex='-1' role='dialog' aria-hidden='true'>";n+="<div class='modal-dialog'>",n+="<div class='modal-content'>",n+="<div class='modal-header'>",n+="<button type='button' class='close' data-dismiss='modal'>",n+="<span aria-hidden='true'>&times;</span></button>",n+="<h4 class='modal-title'>"+t+"</h4>",n+="</div><div class='modal-body'>",n+='<iframe id="frm_'+e+"\" src='"+i+"' scrolling='no' frameborder='0' width='100%' height='"+a+"'></iframe>",n+="</div></div></div></div>",n=$(n),$(this.Element).after(n)},GetFromatValue:function(e,t){return this.FormatRule?null==t?"":void $.MvcSheet.Action({Action:this.FormatAction,Datas:[this.FormatRule,t?t.toString():""],Mask:!1,LoadControlValue:!1,OnActionDone:function(t){e.is("label,span")?e.html(t):e.is("input")&&e.val(t)}}):""}}})(jQuery);