jQuery.extend({MvcSheet:{Version:"V1.0",AjaxUrl:"MvcDefaultSheet/OnLoad",LOADKEY:"load",Actions:[],InitFunctions:[],ReadyFunctions:[],Action_Save:"Save",Action_WorkflowComment:"WorkflowComment",Action_ViewInstance:"ViewInstance",Action_PreviewParticipant:"PreviewParticipant",Action_Print:"Print",Action_CancelInstance:"CancelInstance",Action_Reject:"Reject",Action_Submit:"Submit",Action_FinishInstance:"FinishInstance",Action_Forward:"Forward",Action_Assist:"Assist",Action_Consult:"Consult",Action_Circulate:"Circulate",Action_AdjustParticipant:"AdjustParticipant",Action_LockInstance:"LockInstance",Action_UnLockInstance:"UnLockInstance",Action_Close:"Close",Action_RetrieveInstance:"RetrieveInstance",Action_Viewed:"Viewed",SaveAction:{Action:"Save",Icon:"fa-save",Text:"保存",en_us:"Save",OnActionPreDo:null,OnActionDone:null},WorkflowCommentAction:{Action:"WorkflowComment",Icon:"fa-urgent",Text:"评论",en_us:"WorkflowComment",OnActionPreDo:null,OnActionDone:null},PrintAction:{Action:"Print",Icon:"fa-print",Text:"打印",en_us:"Print",OnActionDone:function(){}},ViewedAction:{Action:"Viewed",Icon:"fa-check",Text:"已阅",en_us:"View",OnActionDone:function(){}},CancelInstanceAction:{Action:"CancelInstance",Icon:"fa-square-o",en_us:"Cancel",Text:"取消流程"},SubmitAction:{Action:"Submit",Icon:"fa-check",Text:"提交",en_us:"Submit",OnActionDone:function(){}},RejectAction:{Action:"Reject",Icon:"fa-mail-reply",Text:"驳回",en_us:"Reject",OnActionDone:function(){}},RetrieveInstanceAction:{Action:"RetrieveInstance",Icon:"fa-sign-in",en_us:"Retrieve",Text:"取回"},ViewInstanceAction:{Action:"ViewInstance",Icon:"fa-ellipsis-v",Text:"流程状态",en_us:"State"},PreviewParticipantAction:{Action:"PreviewParticipant",Icon:"fa-coumns",Text:"预览",en_us:"Preview"},FinishInstanceAction:{Action:"FinishInstance",Icon:"fa-square",Text:"结束流程",en_us:"Finish Instance"},ForwardAction:{Action:"Forward",Icon:"fa-mail-forward",Text:"转办",en_us:"Forward"},AssistAction:{Action:"Assist",Icon:"fa-qrcode",Text:"协办",en_us:"Assist"},ConsultAction:{Action:"Consult",Icon:"fa-phone",Text:"征询意见",en_us:"Consult"},CirculateAction:{Action:"Circulate",Icon:"fa-share-square-o",Text:"传阅",en_us:"Circulate"},AdjustParticipantAction:{Action:"AdjustParticipant",Icon:"fa-random",Text:"加签",en_us:"Plus"},LockInstanceAction:{Action:"LockInstance",Icon:"fa-unlock-alt",Text:"锁定",en_us:"Lock"},UnLockInstanceAction:{Action:"UnLockInstance",Icon:"fa-unlock-alt",Text:"解锁",en_us:"UnLock"},CloseAction:{Action:"Close",Icon:"fa-times",Text:"关闭",en_us:"Close"}}});var loadJSON=function(e,t){return window.sessionStorage.getItem(e)?JSON.parse(window.sessionStorage.getItem(e)):($.ajax({url:t,dataType:"JSON",type:"GET",async:!1,success:function(t){window.sessionStorage.setItem(e,JSON.stringify(t))}}),JSON.parse(window.sessionStorage.getItem(e)))};$.uuid||($.uuid=function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}),jQuery.extend($.MvcSheet,{Init:function(e){var t="";window.location.href.indexOf("?")>-1&&(t=window.location.href.substring(window.location.href.indexOf("?"))),this.AjaxUrl+=t+"&T="+(1e6*Math.random()).toString().substring(0,6),this.LoadData(e)},InitToolBar:function(){0==$.MvcSheet.Actions.length&&$.MvcSheet.AddDefaultActions(),$.MvcSheetUI.SheetInfo.IsMobile&&$.MvcSheet.Actions.forEach(function(e,t){"ViewInstance"!=e.Action||$.MvcSheet.Actions.splice(t,1)});var e=$(".SheetToolBar").SheetToolBar($.MvcSheet.Actions);if($.MvcSheetUI.SheetInfo.IsMobile){var t=[],n=function(e,t){return{text:e.Text,handler:function(){e.ActionClick()},actionKey:t}};for(_Action in e.ControlManagers){var i=e.ControlManagers[_Action];i.MobileVisible&&t.push(n(i,_Action))}var o=$("#dvmButtons");if(0==t.length)o.hide(),o.parents("ion-footer-bar").siblings("ion-content").removeClass("has-footer").end().remove();else if(t.length<4)t.forEach(function(t){var n="icon-left";"Reject"==t.actionKey&&(t.Text=SheetLanguages.Current.Reject),t.actionKey;var i=$('<button class="button foot-button '+n+' button-clear "></button>');i.text(t.text),i.unbind("click."+t.actionKey).bind("click."+t.actionKey,function(){var n,i=new RegExp("(^|&)go=([^&]*)(&|$)","i"),o=window.location.search.substr(1).match(i);try{n=unescape(o[2])}catch(e){}-2==n&&"Close"==t.actionKey?$.MvcSheetUI.IonicFramework.$rootScope&&"dingtalk"==$.MvcSheetUI.IonicFramework.$rootScope.loginfrom?dd.biz.navigation.close({}):$.MvcSheetUI.IonicFramework.$rootScope&&"wechat"==$.MvcSheetUI.IonicFramework.$rootScope.loginfrom?WeixinJSBridge.call("closeWindow"):e.ControlManagers[t.actionKey].ActionClick():e.ControlManagers[t.actionKey].ActionClick()}),o.append(i)});else{var a=[];if(t.forEach(function(t){if("Reject"==t.actionKey||"Submit"==t.actionKey){var n="icon-left";"Reject"==t.actionKey?t.text=SheetLanguages.Current.Reject:(t.text=SheetLanguages.Current.Approve,e.ControlManagers[t.actionKey].Text=SheetLanguages.Current.Approve);var i=$('<button class="button foot-button '+n+' button-clear "></button>');i.text(t.text),i.unbind("click."+t.actionKey).bind("click."+t.actionKey,function(){e.ControlManagers[t.actionKey].ActionClick()}),o.append(i)}else a.push(t)}),a.length>0){var c=$('<button class="button foot-button icon-left button-clear">'+SheetLanguages.Current.More+"</button>"),s=[];a.forEach(function(e){s.push({text:e.text})}),c.unbind("click.moreaction").bind("click.moreaction",function(){console.log("oye!");$.MvcSheetUI.IonicFramework.$ionicActionSheet.show({buttons:s,cancelText:SheetLanguages.Current.Cancel,cancel:function(){return!1},buttonClicked:function(e){return a[e].handler(),!0}})}),o.append(c)}}}window.localStorage.getItem("H3.PortalRoot");$.PublicAddress=loadJSON("PublicAddressData","lang/PublicAddressData.json")},InitHiddenFields:function(){$("input:hidden").each(function(){"SheetHiddenField"==$(this).data("type")&&$(this).SheetHiddenField()})},LoadData:function(e){var t=this;this.GetSheet({Command:this.LOADKEY,Lang:window.localStorage.getItem("H3.Language")},function(t){if($.MvcSheetUI.SheetInfo=t,$.MvcSheetUI.SheetInfo.Language=window.localStorage.getItem("H3.Language"),t.Message&&t.Close)$.MvcSheetUI.IonicFramework.$rootScope&&"dingtalk"==$.MvcSheetUI.IonicFramework.$rootScope.loginfrom?dd.device.notification.alert({message:t.Message,title:"提示",buttonName:"确定",onSuccess:function(){dd.biz.navigation.close({onSuccess:function(e){},onFail:function(e){}})},onFail:function(e){}}):$.MvcSheetUI.IonicFramework.$rootScope&&"wechat"==$.MvcSheetUI.IonicFramework.$rootScope.loginfrom?(alert(t.Message),setTimeout(function(){WeixinJSBridge.call("closeWindow")},1e3)):(alert(t.Message),setTimeout(function(){$.MvcSheet.ClosePage()},1e3));else{if($.MvcSheetUI.SheetInfo.PageScript){var n=$('<script type="text/javascript">'+$.MvcSheetUI.SheetInfo.PageScript+"</script>");$("body").append(n)}if($.MvcSheet.PreInitLanguage(),$.MvcSheetUI.SheetInfo.IsMobile?($(".divContent:last").append('<div class="list"><div class="item item-input"><span data-type="SheetLabel" class="input-label" data-datafield="Sheet__ConsultComment">'+SheetLanguages.Current.ConsultComment+'<</span><div class="detail"><div data-datafield="Sheet__ConsultComment" data-type="SheetComment"></div></div></div></div>'),$(".divContent:last").append('<div class="list"><div class="item item-input"><span data-type="SheetLabel" class="input-label" data-datafield="Sheet__AssistComment">'+SheetLanguages.Current.AssistComment+'</span><div class="detail"><div data-datafield="Sheet__AssistComment" data-type="SheetComment"></div></div></div></div>'),$(".divContent:last").append('<div class="list"><div class="item item-input"><span data-type="SheetLabel" class="input-label" data-datafield="Sheet__ForwardComment">'+SheetLanguages.Current.ForwardComment+'</span><div class="detail"><div data-datafield="Sheet__ForwardComment" data-type="SheetComment"></div></div></div></div>')):($(".divContent:last").append('<div class="row tableContent"><div class="col-md-2"><span data-type="SheetLabel" data-datafield="Sheet__ConsultComment">'+SheetLanguages.Current.ConsultComment+'</span></div><div class="col-md-10"><div data-datafield="Sheet__ConsultComment" data-type="SheetComment"></div></div></div>'),$(".divContent:last").append('<div class="row tableContent"><div class="col-md-2"><span data-type="SheetLabel" data-datafield="Sheet__AssistComment">'+SheetLanguages.Current.AssistComment+'</span></div><div class="col-md-10"><div data-datafield="Sheet__AssistComment" data-type="SheetComment"></div></div></div>'),$(".divContent:last").append('<div class="row tableContent"><div class="col-md-2"><span data-type="SheetLabel" data-datafield="Sheet__ForwardComment">'+SheetLanguages.Current.ForwardComment+'</span></div><div class="col-md-10"><div data-datafield="Sheet__ForwardComment" data-type="SheetComment"></div></div></div>')),$.MvcSheet.PreInit.apply(this,[$.MvcSheetUI.SheetInfo]),$.MvcSheet.InitFunctions.length>0)for(var i=0;i<$.MvcSheet.InitFunctions.length;i++)$.MvcSheet.InitFunctions[i].call(this,$.MvcSheetUI.SheetInfo);$.MvcSheet.InitToolBar();for(var o=$("["+$.MvcSheetUI.PreDataKey+$.MvcSheetUI.DataFieldKey.toLowerCase()+"]"),a=[],c=[],s=(i=0,o.length);i<s;i++){var r=o[i];"table"==r.tagName.toLowerCase()?c.push(r):0==$(r).parents("tr.template").length&&a.push(r)}for(i=0,s=a.length;i<s;i++)$(a[i]).SheetUIManager();for(i=0,s=c.length;i<s;i++)$(c[i]).SheetUIManager();if($.MvcSheet.InitHiddenFields(),$.MvcSheetUI.SheetInfo.IsMobile?$("ion-content").removeClass("ng-cloak"):($("div[class^='col-md-']").each(function(){var e=!0;if($(this).text())e=!1;else for(var t=$(this).find("["+$.MvcSheetUI.PreDataKey+$.MvcSheetUI.DataFieldKey.toLowerCase()+"]"),n=0;n<t.length;n++){var i=$(t).SheetUIManager();if(!i){var o=$(t).attr($.MvcSheetUI.PreDataKey+$.MvcSheetUI.DataFieldKey.toLowerCase());return void alert("数据项:{"+o+"}不存在")}if(i.Visiable){e=!1;break}}e&&$(this).hide()}),$("div[class='row']").each(function(){0==$(this).find("div:visible[class^='col-md-']").length&&$(this).hide()})),"function"==typeof e&&e(),$.MvcSheet.RenderLanguage(),$.MvcSheet.Rendered.apply(this,[$.MvcSheetUI.SheetInfo]),$.MvcSheet.Loaded.apply(this,[$.MvcSheetUI.SheetInfo]),$.MvcSheet.ReadyFunctions.length>0)for(i=0;i<$.MvcSheet.ReadyFunctions.length;i++)$.MvcSheet.ReadyFunctions[i].call(this,$.MvcSheetUI.SheetInfo)}},function(e){alert("表单数据加载失败，请稍候再试!")},!1,function(){var e="正在努力加载...";$.MvcSheetUI.Loading=!0,t.AjaxUrl.toLowerCase().indexOf("ismobile")>-1&&(e="",$.LoadingMask.Show(e,!1))},function(){$.MvcSheetUI.Loading=!1,$.LoadingMask.Hide()})},Ready:function(e){$.MvcSheet.ReadyFunctions.push(e)},PreInitLanguage:function(){var e=$.MvcSheetUI.SheetInfo.Language;void 0!==SheetLanguages[e]&&null!=SheetLanguages[e]||(e="zh_cn"),e&&"null"!=e||(e="zh_cn"),$.extend(SheetLanguages.Current,SheetLanguages[e])},RenderLanguage:function(){var e=$.MvcSheetUI.SheetInfo.Language;e&&(e=$.MvcSheetUI.PreDataKey+e.replace("-","_"),$("span["+e+"],label["+e+"]").each(function(){$(this).html($(this).attr(e))})),1==$.MvcSheetUI.SheetInfo.IsMobile&&($("#divFullName .input-label").text(SheetLanguages.Current.BasicInfo.divFullName),$("#divOriginateDate .input-label").text(SheetLanguages.Current.BasicInfo.divOriginateDate),$($("#divOriginateOUName .input-label")[0]).text(SheetLanguages.Current.BasicInfo.divOriginateOUName),$("#divSequenceNo .input-label").text(SheetLanguages.Current.BasicInfo.divSequenceNo))},PreInit:function(){},PreLoad:function(e){$.MvcSheet.InitFunctions.push(e)},Loaded:function(){},Rendered:function(){if($("input,textarea,select").addClass($.MvcSheetUI.Css.inputMouseOut).unbind("mouseover.style").bind("mouseover.style",function(){var e=$(this);e.parent().is("li")&&e.parent().parent().parent().is("div")&&(e=e.parent().parent().parent()),e.removeClass($.MvcSheetUI.Css.inputMouseOut).addClass($.MvcSheetUI.Css.inputMouseMove)}).unbind("mouseenter.style").bind("mouseenter.style",function(){var e=$(this);e.parent().is("li")&&e.parent().parent().parent().is("div")&&(e=e.parent().parent().parent()),e.removeClass($.MvcSheetUI.Css.inputMouseMove).addClass($.MvcSheetUI.Css.inputMouseEnter)}).unbind("mouseout.style").bind("mouseout.style",function(){var e=$(this);e.parent().is("li")&&e.parent().parent().parent().is("div")&&(e=e.parent().parent().parent()),e.removeClass($.MvcSheetUI.Css.inputMouseEnter).removeClass($.MvcSheetUI.Css.inputMouseMove).addClass($.MvcSheetUI.Css.inputMouseOut)}),$.MvcSheetUI.SheetInfo.IsMobile){var e=$("select[data-datafield]");if(e&&e.length>0)for(var t=0;t<e.length;t++){var n=$(e[t]).SheetUIManager();if($(e[t]).attr("data-datafield").indexOf(".")>-1&&(n=$(e[t]).SheetUIManager($(e[t]).parent().parent().attr("data-row"))),n&&!n.Editable){if($.MvcSheetUI.SheetInfo.IsOriginateMode&&"Originator.OUName"==$(e[t]).attr("data-datafield")&&$(e[t]).find("option").length>1)break;$(e[t]).siblings(".afFakeSelect").hide()}}}$.MvcSheetUI.MvcRuntime=new Sheet},Action:function(e){(void 0===e.Mask||e.Mask)&&$.LoadingMask.Show((e.Text||SheetLanguages.Current.Doing)+"...");var t=e.Action,n=e.Datas,i={Command:t},o=[];if(void 0===e.LoadControlValue||e.LoadControlValue){if(n)for(var a=0;a<n.length;a++)if(0==n[a].toString().indexOf("{")){var c=n[a].replace("{","").replace("}","");o.push($.MvcSheetUI.GetControlValue(c))}else if(0==n[a].toString().indexOf("#")){c=n[a].replace("#");o.push($.MvcSheetUI.GetControlValue(n[a]))}else o.push(n[a])}else o=n;i.Param=JSON.stringify(o),e.PostSheetInfo&&(i.MvcPostValue=JSON.stringify(this.GetMvcPostValue(this.actionName)));var s=this;this.PostSheet(i,function(t){e.OnActionDone&&e.OnActionDone.apply(e,[t]),s.ResultHandler.apply(s,[e,t]),e.CloseAfterAction&&$.MvcSheet.ClosePage(),$.LoadingMask.Hide()},void 0,e.Async)},AlertAction:function(e,t){if($.MvcSheetUI.IonicFramework.$ionicPopup)$.MvcSheetUI.IonicFramework.$ionicPopup.show({cssClass:"bpm-sheet-AlertAction",template:"<span>"+e+"<span>",buttons:[{text:SheetLanguages.Current.Confirm,type:"button-clear",onTap:function(e){t()}}]});else alert(e)&&t()},ConfirmAction:function(e,t){if($.MvcSheetUI.IonicFramework.$ionicPopup)$.MvcSheetUI.IonicFramework.$ionicPopup.show({cssClass:"bpm-sheet-ConfirmAction",template:"<span>"+e+"<span>",buttons:[{text:SheetLanguages.Current.Cancel,type:"button-clear"},{text:SheetLanguages.Current.Confirm,type:"button-clear",onTap:function(e){console.log(e),t()}}]});else confirm(e)&&t()},ActionValidata:function(e,t){var n=!0;return this.Validate&&(n=this.Validate.apply(e)),!(!n&&null!=n)&&$.MvcSheetUI.Validate(e,t)},WorkflowComment:function(e){e.IsMobile&&($.MvcSheetUI.actionCommentParam={title:e.text,Action:e.Action,DisplayName:e.SheetInfo.DisplayName,UserName:e.SheetInfo.UserName,OriginatorOU:e.SheetInfo.OriginatorOU,Text:e.text,UserId:e.SheetInfo.UserID,workItemId:$.MvcSheetUI.SheetInfo.WorkItemId},$.MvcSheetUI.IonicFramework.$state.go("form.commentDetail"))},Save:function(e){if(!$.MvcSheet.ActionValidata(e,!0))return!1;$.LoadingMask.Show(SheetLanguages.Current.Saving);var t=this.GetMvcPostValue(this.Action_Save),n=this;this.PostSheet({Command:this.Action_Save,MvcPostValue:JSON.stringify(t)},function(t){n.ResultHandler.apply(n,[e,t])})},Submit:function(e,t,n,i){if($.MvcSheetUI.SheetInfo.IsMobile){var o=$("#divSheet input[data-type='SheetTextBox']");o.each(function(){$(this).trigger("change")})}if(!$.MvcSheet.ActionValidata(e))return!1;var a=this;$.MvcSheet.ConfirmAction(SheetLanguages.Current.ConfirmDo+"【"+t+"】"+SheetLanguages.Current.Operation+"?",function(){"JSLYApprove"==$.MvcSheetUI.SheetInfo.WorkflowCode&&"Activity8"==$.MvcSheetUI.SheetInfo.ActivityCode&&siolon_test();var t=a.GetMvcPostValue(a.Action_Submit,n,i);a.PostSheet({Command:a.Action_Submit,MvcPostValue:JSON.stringify(t)},function(t){a.ResultHandler.apply(a,[e,t])})})},ControlInit:function(){},ControlPreRender:function(){},ControlRendered:function(){},Reject:function(e,t){if(e.IsReject=!0,!$.MvcSheet.ActionValidata(e))return!1;var n=this;$.MvcSheet.ConfirmAction(SheetLanguages.Current.ConfirmDo+"【"+SheetLanguages.Current.Reject+"】"+SheetLanguages.Current.Operation+"?",function(){$.LoadingMask.Show(SheetLanguages.Current.Rejecting);var i=n.GetMvcPostValue(n.Action_Reject,t);n.PostSheet({Command:n.Action_Reject,MvcPostValue:JSON.stringify(i)},function(t){n.ResultHandler.apply(n,[e,t])})})},FinishInstance:function(e){$.LoadingMask.Show(SheetLanguages.Current.Finishing);var t=this.GetMvcPostValue(this.Action_FinishInstance),n=this;this.PostSheet({Command:this.Action_FinishInstance,MvcPostValue:JSON.stringify(t)},function(t){n.ResultHandler.apply(n,[e,t])})},RetrieveInstance:function(e){var t=this;this.GetSheet({Command:this.Action_RetrieveInstance},function(n){t.ResultHandler.apply(t,[e,n])},function(){},!0,function(){$.LoadingMask.Show(SheetLanguages.Current.Retrieving)},function(){})},GetMvcPostValue:function(e,t,n){var i={Command:e,DestActivityCode:t,PostValue:n,BizObjectId:$.MvcSheetUI.SheetInfo.BizObjectID,InstanceId:$.MvcSheetUI.SheetInfo.InstanceId,BizObject:{}};return i.BizObject.DataItems=$.MvcSheetUI.SaveSheetData(e),i.Priority=$.MvcSheetUI.Priority,i.HiddenFields=$.MvcSheetUI.HiddenFields,i.ParentUnitID=$.MvcSheetUI.ParentUnitID,i},ResultHandler:function(actionControl,data){if(data.UserIsNull||"true"==data.UserIsNull)return alert("用户信息已失效，请重新登录！"),void $.LoadingMask.Hide();if($.MvcSheet.ActionDone&&$.MvcSheet.ActionDone.apply(actionControl,[data]),"undefined"!=data&&null!=data){if(data.EvalStr){var message=eval(data.EvalStr);data.Message?data.Message=data.Message+message:data.Message=message}if(data.Successful){if(top.postMessage("TotalCount","*"),$.MvcSheetUI.SheetInfo.IsMobile){if("Save"==actionControl.Action&&!$.MvcSheetUI.SheetInfo.IsOriginateMode)return void $.LoadingMask.Hide();if("Save"==actionControl.Action&&$.MvcSheetUI.SheetInfo.IsOriginateMode)return $.LoadingMask.Hide(),void($.MvcSheetUI.IonicFramework.$rootScope.dingMobile.isDingMobile?window.location.href=data.Url:window.location.replace(data.Url));if("Assist"!=actionControl.Action&&"Consult"!=actionControl.Action&&"Circulate"!=actionControl.Action)if($.MvcSheetUI.IonicFramework.$rootScope.dingMobile.isDingMobile&&"dingtalk"==$.MvcSheetUI.IonicFramework.$rootScope.loginfrom)dd.biz.navigation.goBack({onSuccess:function(e){},onFail:function(e){}});else if("undefined"!=typeof WeixinJSBridge&&"message"==$.MvcSheetUI.IonicFramework.$rootScope.source)WeixinJSBridge.call("closeWindow");else if("wechat"==$.MvcSheetUI.IonicFramework.$rootScope.loginfrom){var goIndex=$.MvcSheetUI.IonicFramework.$rootScope.orgIndex-window.history.length-1;window.history.go(goIndex)}else window.history.go(-1);else if($.LoadingMask.Hide(),data.Message)return void alert(data.Message)}else if(data.ClosePage||"Assist"===actionControl.Action){var t=Date.now();function sleep(e){for(;Date.now()-t<=e;);}if(sleep(500),data.IsSaveAction){if(data.Refresh){var href=window.location.href;href=href.replace("&T=","&T="+Math.round(100*Math.random(),0)),window.location.href=href}}else $.MvcSheet.ClosePage();"Forward"===actionControl.Action&&alert(eval(data.EvalStr))}else if(data.Url)window.location.href=data.Url;else if(data.Message){if(data.Refresh){var href=window.location.href;href=href.replace("&T=","&T="+Math.round(100*Math.random(),0)),window.location.href=href}alert(data.Message)}}else{if(data.Errors)for(var i=0;i<data.Errors.length;i++)alert(data.Errors[i]);data.Message&&alert(data.Message)}$.LoadingMask.Hide()}},ClosePage:function(){try{null!=window.opener&&null!=window.opener.location&&window.opener.location.href!=window.location.href&&"originate"!=$.MvcSheetUI.QueryString("Mode").toLowerCase()?(window.opener.location.reload(),window.close()):(window.close(),window.open("about:blank","_self")),top.window.postMessage("ClosePage","*"),this.IsPC()||($.MvcSheetUI.IonicFramework.$rootScope.dingMobile.isDingMobile?dd.biz.navigation.close({}):window.history.go(-1))}catch(e){window.close()}},IsPC:function(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=!0,i=0;i<t.length;i++)if(e.indexOf(t[i])>0){n=!1;break}return n},AddDefaultActions:function(){$.MvcSheetUI.SheetInfo&&$.MvcSheetUI.SheetInfo.IsMobile?this.Actions.splice(0,this.Actions.length,this.RetrieveInstanceAction,this.SaveAction,this.ViewInstanceAction,this.PreviewParticipantAction,this.PrintAction,this.ViewedAction,this.CancelInstanceAction,this.RejectAction,this.SubmitAction,this.FinishInstanceAction,this.ForwardAction,this.AssistAction,this.ConsultAction,this.CirculateAction,this.AdjustParticipantAction,this.LockInstanceAction,this.UnLockInstanceAction,this.CloseAction,this.WorkflowCommentAction):this.Actions.splice(0,this.Actions.length,this.RetrieveInstanceAction,this.SaveAction,this.ViewInstanceAction,this.PreviewParticipantAction,this.PrintAction,this.ViewedAction,this.CancelInstanceAction,this.SubmitAction,this.RejectAction,this.FinishInstanceAction,this.ForwardAction,this.AssistAction,this.ConsultAction,this.CirculateAction,this.AdjustParticipantAction,this.LockInstanceAction,this.UnLockInstanceAction,this.CloseAction)},AddAction:function(e){if($.MvcSheetToolbar.AddButton?$.MvcSheetToolbar.AddButton(e):0==this.Actions.length&&this.AddDefaultActions(),e.PreAction){for(var t in this.Actions)if(this.Actions[t].Action==e.PreAction){t<this.Actions.length-1&&t++,this.Actions.splice(t,0,e);break}}else this.Actions.push(e)},GetSheet:function(e,t,n,i,o,a){$.ajax({type:"GET",url:this.AjaxUrl,dataType:"json",async:i,data:e,beforeSend:o,success:t,complete:a,error:n})},PostSheet:function(e,t,n,i){var o=this.AjaxUrl;-1==o.indexOf("http://")&&(o=window.location.href.substr(0,window.location.href.indexOf("MvcDefaultSheet"))+this.AjaxUrl),-1==o.toLowerCase().indexOf("&bizobjectid=")&&(o=o+"&BizObjectID="+$.MvcSheetUI.SheetInfo.BizObjectID),void 0===i&&(i=!0),void 0===n&&(n=function(e){alert("系统出现异常!"),$.LoadingMask.Hide()}),$.ajax({type:"POST",url:o,data:e,dataType:"json",async:i,success:t,error:n})}});